<!DOCTYPE html>
<html>
  <head>
    <base href="{{redirectUri}}" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" />
    <meta charset="utf-8" />
    <meta content="text/html" http-equiv="Content-Type" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0"
    />
    <title>Auth Provider Test</title>
    <style>
      .text-center {
        text-align: center;
      }

      pre {
        overflow-x: auto;
        white-space: pre-wrap;
        white-space: -moz-pre-wrap;
        white-space: -pre-wrap;
        white-space: -o-pre-wrap;
        word-wrap: break-word;
      }
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/oidc-client/1.11.5/oidc-client.js"
      integrity="sha512-pH7OSLRxkHElePmZdZIEknPr9lYKn5KC69xj/jlzKEEcdzjjMpTqzVEe+EYN/Rcay2L0nfw/X9zPOm6CXQ6B/A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script>
      var settings = {
        authority: 'https://localhost:7000',
        client_id: 'oidc-debugger',
        redirect_uri: 'https://localhost:7000/app/index.html',
        post_logout_redirect_uri: 'https://localhost:7000/app/index.html',
        response_type: 'code',
        scope: 'openid email',
        loadUserInfo: true,
        revokeAccessTokenOnSignout: false

      };
      var mgr = null;

      function closeWindow() {
        mgr
          .signoutRedirect()
          .then(function () {})
          .catch(function (err) {alert(err);});
      }

      function login() {
          mgr.signinRedirect({});
        }


      window.onload = function () {
        if (window.location.href.indexOf('closeWindow') > 0) {
          setTimeout(function () {
            window.close();
          });
        }
        mgr = new Oidc.UserManager({
          ...settings,
          userStore: new Oidc.WebStorageStateStore({
            store: window.localStorage
          })
        });

        let txtResult = document.getElementById('loginResult');


        function showUser(user) {
          txtResult.innerHTML =
            JSON.stringify(user, null, 2) +
            '</code></pre>';
        }

        mgr
          .signinRedirectCallback()
          .then(function (user) {
            showUser(user);
          })
          .catch(function (err) {
            //alert(err);
            //login();
          });
      };
    </script>
  </head>

  <body>
    <div id="loginResult"></div>
    <br />
    <div class="text-center">
      <button type="button" onclick="login()">Login</button>
      <button type="button" onclick="closeWindow()">Signout & Close</button>
    </div>
  </body>
</html>
